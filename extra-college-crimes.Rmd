---
title: "R Notebook"
output: html_notebook
---
##### Loading in 2014-2022 data

```{r}
ten_year_clean <- read_csv("campus_ten_years_clean.csv")
```


filter out 2012 and the on campus-studenthousing
```{r}
new_ten_year <- ten_year_clean %>% filter(survey_year != "2012")

new_ten_year <- new_ten_year %>% filter(category != "on campus-student housing")


```

group by year, institution
```{r}
total_crime_decade <- new_ten_year %>% group_by(survey_year, unitid, institution_me) %>% summarise(total_crime = sum(total_crime))

total_crime_decade <- total_crime_decade %>% pivot_wider(names_from = survey_year, values_from = total_crime)
```

join with enrollment table
```{r}
total_crime_decade <- total_crime_decade %>% inner_join(enrollment_ten_years, by=c("unitid","institution_me"="institution_name"))

total_crime_decade <- total_crime_decade %>% clean_names()

total_crime_decade <- total_crime_decade %>% mutate(x2012_13_fte_12_month_enrollment = as.numeric(x2012_13_fte_12_month_enrollment)) %>%
  mutate(x2013_14_fte_12_month_enrollment = as.numeric(x2013_14_fte_12_month_enrollment)) %>%
  mutate(x2014_15_fte_12_month_enrollment = as.numeric(x2014_15_fte_12_month_enrollment)) %>%
  mutate(x2015_16_fte_12_month_enrollment = as.numeric(x2015_16_fte_12_month_enrollment)) %>%
  mutate(x2016_17_fte_12_month_enrollment = as.numeric(x2016_17_fte_12_month_enrollment)) %>%
  mutate(x2017_18_fte_12_month_enrollment = as.numeric(x2017_18_fte_12_month_enrollment)) %>%
  mutate(x2018_19_fte_12_month_enrollment = as.numeric(x2018_19_fte_12_month_enrollment)) %>%
  mutate(x2019_20_fte_12_month_enrollment = as.numeric(x2019_20_fte_12_month_enrollment)) %>%
  mutate(x2020_21_fte_12_month_enrollment = as.numeric(x2020_21_fte_12_month_enrollment)) %>%
  mutate(x2021_22_fte_12_month_enrollment = as.numeric(x2021_22_fte_12_month_enrollment))
                                  
```

```{r}

total_crime_decade <- total_crime_decade %>% 
  mutate(total_crime_rate_2013 = x2013/x2012_13_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2014 = x2014/x2013_14_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2015 = x2015/x2014_15_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2016 = x2016/x2015_16_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2017 = x2017/x2016_17_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2018 = x2018/x2017_18_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2019 = x2019/x2018_19_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2020 = x2020/x2019_20_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2021 = x2021/x2020_21_fte_12_month_enrollment*1000) %>%
  mutate(total_crime_rate_2022 = x2022/x2021_22_fte_12_month_enrollment*1000)

```



```{r}
total_crime_decade_clean <- total_crime_decade %>% 
  select(unitid,
         institution_me,
         total_crime_rate_2013,
         total_crime_rate_2014,
         total_crime_rate_2015,
         total_crime_rate_2016,
         total_crime_rate_2017,
         total_crime_rate_2018,
         total_crime_rate_2019,
         total_crime_rate_2020,
         total_crime_rate_2021,
         total_crime_rate_2022
         )
```




write csv with updates
```{r}
new_ten_year_v3 <- read_csv("new_ten_year_v3.csv")

new_ten_year_v4 <- new_ten_year_v3 %>% filter(campus_me != "Universities at Shady Grove") %>% 
  filter(campus_me != "Shady Grove Campus") %>% 
  filter(campus_me != "The Universities at Shady Grove") %>% 
  filter(campus_me != "University System of Maryland - Hagerstown") %>% 
  filter(campus_me != "Universities at Shady Grove") %>% 
  filter(campus_me != "Salisbury University at University System of Maryland-Hagerstown") %>% 
  filter(campus_me != "University System of Maryland Hagerstown") %>% 
  filter(campus_me != "SalisburyUniversity at Eastern Shore Higher Education Center") %>% 
  filter(campus_me != "The University System of Maryland at Southern Maryland") %>% 
  filter(campus_me != "The USMH â€“ 24 North Walnut St. Hagerstown- Md")


new_ten_year_v5 <- new_ten_year_v8 %>% group_by(survey_year, institution_me, campus_me) %>% summarise(count = n()) %>% arrange(desc(count))

new_ten_year_v5 %>% group_by(survey_year, institution_me) %>% summarise(count = n()) %>% arrange(desc(institution_me))

new_ten_year_v5 %>% filter(institution_me == "Frostburg State University") %>% arrange(desc(survey_year))

new_ten_year_v5 %>% filter()







```
I had to export a csv and reload in bc of an error


In Baltimore city/area
```{r}
df %>% group_by(in_baltimore_city) %>% summarise(count = n())
df %>% group_by(in_baltimore_area) %>% summarise(count = n())
```
204/576 or nearly 35.4% in Baltimore City
342/576 or over 59% in Baltimore area

Public/HBCU
```{r}
clery %>% group_by(public) %>% summarise(count = n())
clery %>% group_by(hbcu) %>% summarise(count = n())
```
Public: 254/576 or 44%
HBCU: 75/576 or 13%



#### Crime by region, balt vs not balt
```{r}
total_crime_md_geo <- 
  new_ten_year_v8 %>% 
  group_by(survey_year, in_baltimore_area) %>% 
  summarise(total_crime = sum(total_crime))

violent_crime_md_geo <- 
  new_ten_year_v8 %>% 
  group_by(survey_year, in_baltimore_area) %>% 
  summarise(violent_crime = sum(violent_crime))

sexual_crime_md_geo <- 
  new_ten_year_v8 %>% 
  group_by(survey_year, in_baltimore_area) %>% 
  summarise(sexual_crime = sum(sexual_crime))
                         
                            
```



### join with enrollment table
```{r}

total_crime_md_rate_geo <- total_crime_md_geo %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))

violent_crime_md_rate_geo <- violent_crime_md_geo %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))

sexual_crime_md_rate_geo <- sexual_crime_md_geo %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))



total_crime_md_rate_geo <- total_crime_md_rate_geo %>% mutate(total_crime_rate = total_crime/enrollment*1000)

total_crime_md_rate_geo_no <- total_crime_md_rate_geo %>% filter(in_baltimore_area == "n")
total_crime_md_rate_geo_yes <- total_crime_md_rate_geo %>% filter(in_baltimore_area == "y")

total_crime_md_rate_geo <- total_crime_md_rate_geo_no %>% inner_join(total_crime_md_rate_geo_yes, by="survey_year")


total_crime_md_rate_balt_area <- total_crime_md_rate_geo %>% select(survey_year, total_crime_rate.x, total_crime_rate.y) %>% rename("total_crime_rate_no"="total_crime_rate.x") %>% rename("total_crime_rate_yes"="total_crime_rate.y")




violent_crime_md_rate_geo <- violent_crime_md_rate_geo %>% mutate(violent_crime_rate = violent_crime/enrollment*1000)

violent_crime_md_rate_geo_no <- violent_crime_md_rate_geo %>% filter(in_baltimore_area == "n")
violent_crime_md_rate_geo_yes <- violent_crime_md_rate_geo %>% filter(in_baltimore_area == "y")

violent_crime_md_rate_geo <- violent_crime_md_rate_geo_no %>% inner_join(violent_crime_md_rate_geo_yes, by="survey_year")


violent_crime_md_rate_balt_area <- violent_crime_md_rate_geo %>% select(survey_year, violent_crime_rate.x, violent_crime_rate.y) %>% rename("violent_crime_rate_no"="violent_crime_rate.x") %>% rename("violent_crime_rate_yes"="violent_crime_rate.y")




sexual_crime_md_rate_geo <- sexual_crime_md_rate_geo %>% mutate(sexual_crime_rate = sexual_crime/enrollment*1000)

sexual_crime_md_rate_geo_no <- sexual_crime_md_rate_geo %>% filter(in_baltimore_area == "n")
sexual_crime_md_rate_geo_yes <- sexual_crime_md_rate_geo %>% filter(in_baltimore_area == "y")

sexual_crime_md_rate_geo <- sexual_crime_md_rate_geo_no %>% inner_join(sexual_crime_md_rate_geo_yes, by="survey_year")


sexual_crime_md_rate_balt_area <- sexual_crime_md_rate_geo %>% select(survey_year, sexual_crime_rate.x, sexual_crime_rate.y) %>% rename("sexual_crime_rate_no"="sexual_crime_rate.x") %>% rename("sexual_crime_rate_yes"="sexual_crime_rate.y")


                                  
```


#### Crime by region, balt CITY vs not balt
```{r}
total_crime_md_geo2 <- 
  new_ten_year_v4 %>% 
  group_by(survey_year, in_baltimore_city) %>% 
  summarise(total_crime = sum(total_crime))

violent_crime_md_geo2 <- 
  new_ten_year_v4 %>% 
  group_by(survey_year, in_baltimore_city) %>% 
  summarise(violent_crime = sum(violent_crime))

sexual_crime_md_geo2 <- 
  new_ten_year_v4 %>% 
  group_by(survey_year, in_baltimore_city) %>% 
  summarise(sexual_crime = sum(sexual_crime))
                         
                            
```

join with enrollment table
```{r}

total_crime_md_rate_geo2 <- total_crime_md_geo2 %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))

violent_crime_md_rate_geo2 <- violent_crime_md_geo2 %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))

sexual_crime_md_rate_geo2 <- sexual_crime_md_geo2 %>% inner_join(enrollment_ten_years_md, by=c("survey_year"="year"))



total_crime_md_rate_geo2 <- total_crime_md_rate_geo2 %>% mutate(total_crime_rate = total_crime/enrollment*1000)

total_crime_md_rate_geo_no2 <- total_crime_md_rate_geo2 %>% filter(in_baltimore_city == "n")
total_crime_md_rate_geo_yes2 <- total_crime_md_rate_geo2 %>% filter(in_baltimore_city == "y")

total_crime_md_rate_geo2 <- total_crime_md_rate_geo_no2 %>% inner_join(total_crime_md_rate_geo_yes2, by="survey_year")


total_crime_md_rate_balt_city2 <- total_crime_md_rate_geo2 %>% select(survey_year, total_crime_rate.x, total_crime_rate.y) %>% rename("total_crime_rate_no"="total_crime_rate.x") %>% rename("total_crime_rate_yes"="total_crime_rate.y")




violent_crime_md_rate_geo2 <- violent_crime_md_rate_geo2 %>% mutate(violent_crime_rate = violent_crime/enrollment*1000)

violent_crime_md_rate_geo_no2 <- violent_crime_md_rate_geo2 %>% filter(in_baltimore_city == "n")
violent_crime_md_rate_geo_yes2 <- violent_crime_md_rate_geo2 %>% filter(in_baltimore_city == "y")

violent_crime_md_rate_geo2 <- violent_crime_md_rate_geo_no2 %>% inner_join(violent_crime_md_rate_geo_yes2, by="survey_year")


violent_crime_md_rate_balt_city <- violent_crime_md_rate_geo2 %>% select(survey_year, violent_crime_rate.x, violent_crime_rate.y) %>% rename("violent_crime_rate_no"="violent_crime_rate.x") %>% rename("violent_crime_rate_yes"="violent_crime_rate.y")



sexual_crime_md_rate_geo2 <- sexual_crime_md_rate_geo2 %>% mutate(sexual_crime_rate = sexual_crime/enrollment*1000)

sexual_crime_md_rate_geo_no2 <- sexual_crime_md_rate_geo2 %>% filter(in_baltimore_city == "n")
sexual_crime_md_rate_geo_yes2 <- sexual_crime_md_rate_geo2 %>% filter(in_baltimore_city == "y")

sexual_crime_md_rate_geo2 <- sexual_crime_md_rate_geo_no2 %>% inner_join(sexual_crime_md_rate_geo_yes2, by="survey_year")


sexual_crime_md_rate_balt_city <- sexual_crime_md_rate_geo2 %>% select(survey_year, sexual_crime_rate.x, sexual_crime_rate.y) %>% rename("sexual_crime_rate_no"="sexual_crime_rate.x") %>% rename("sexual_crime_rate_yes"="sexual_crime_rate.y")


                                  
```

```{r}


enrollment_ten_years_md <- enrollment_ten_years %>% summarise(x2013 = 
                                     sum(x2012_13_fte_12_month_enrollment), 
                                   x2014 = 
                                     sum(x2013_14_fte_12_month_enrollment), 
                                   x2015 = 
                                     sum(x2014_15_fte_12_month_enrollment), 
                                   x2016 = 
                                     sum(x2015_16_fte_12_month_enrollment), 
                                   x2017 = 
                                     sum(x2016_17_fte_12_month_enrollment), 
                                   x2018 = 
                                     sum(x2017_18_fte_12_month_enrollment), 
                                   x2019 = 
                                     sum(x2018_19_fte_12_month_enrollment), 
                                   x2020 = 
                                     sum(x2019_20_fte_12_month_enrollment), 
                                   x2021 = 
                                     sum(x2020_21_fte_12_month_enrollment), 
                                   x2022 = 
                                     sum(x2021_22_fte_12_month_enrollment)
                                   )

enrollment_ten_years_md <- enrollment_ten_years_md %>% mutate(state="MD")

enrollment_ten_years_md <- enrollment_ten_years_md %>% pivot_longer(x2013:x2022, names_to = "year", values_to = "enrollment")
                                   
enrollment_ten_years_md <- enrollment_ten_years_md %>% mutate(year = substr(year, 3,4))                                
                                   
```




## Calculating average for each category, college over few decades
```{r}
total_crim_count <- total_crime_uni %>% group_by(institution_me) %>% summarise(counta = n()) 

total_crime_uni2 <- total_crime_uni %>% inner_join(total_crim_count, by="institution_me")

sum_total_crime_rate <- total_crime_uni2 %>% group_by(institution_me) %>% summarise(sum_crime_rate = sum(total_crime_rate)) 

avergae_total_crime_rate_uni <- sum_total_crime_rate %>% inner_join(total_crim_count, by= "institution_me") %>% mutate(avg_crime_rate = sum_crime_rate/counta)




violent_crime_uni2 <- violent_crime_uni %>% filter(survey_year != 13) 

violent_crime_uni2 %>% group_by(institution_me) %>% summarise(count = n())


violent_crim_count <- violent_crime_uni2 %>% group_by(institution_me) %>% summarise(counta = n()) 

violent_crime_uni2 <- violent_crime_uni2 %>% inner_join(violent_crim_count, by="institution_me")

sum_violent_crime_rate <- violent_crime_uni2 %>% group_by(institution_me) %>% summarise(sum_crime_rate = sum(violent_crime_rate)) 

avergae_violent_crime_rate_uni <- sum_violent_crime_rate %>% inner_join(violent_crim_count, by= "institution_me") %>% mutate(avg_crime_rate = sum_crime_rate/counta)




sexual_crime_uni2 <- sexual_crime_uni %>% filter(survey_year != 13) 

sexual_crime_uni2 %>% group_by(institution_me) %>% summarise(count = n())


sexual_crim_count <- sexual_crime_uni2 %>% group_by(institution_me) %>% summarise(counta = n()) 

sexual_crime_uni2 <- sexual_crime_uni2 %>% inner_join(sexual_crim_count, by="institution_me")

sum_sexual_crime_rate <- sexual_crime_uni2 %>% group_by(institution_me) %>% summarise(sum_crime_rate = sum(sexual_crime_rate)) 

avergae_sexual_crime_rate_uni <- sum_sexual_crime_rate %>% inner_join(sexual_crim_count, by= "institution_me") %>% mutate(avg_crime_rate = sum_crime_rate/counta)

```




## Sort by specific crime
```{r}
specific_crimes_2022_by_uni <- df %>% filter(survey_year == "2022") %>% 
  group_by(institution_me) %>% 
  summarise(sum_total_crime = sum(total_crime), 
            sum_murder = sum(murder_non_negligent_manslaughter), 
            sum_neg_manslaughter = sum(negligent_manslaughter), 
            sum_robbery = sum(robbery), 
            sum_agg_assault = sum(aggravated_assault),
            sum_rape = sum(rape), 
            sum_fondling = sum(fondling),
            sum_statutory = sum(statutory_rape),
            sum_incest = sum(incest),
            sum_burglary = sum(burglary),
            sum_motor = sum(motor_vehicle_theft),
            sum_arson = sum(arson)
            ) 

specific_crimes_2022_by_uni <- specific_crimes_2022_by_uni %>% 
  mutate(pct_murder = sum_murder/sum_total_crime*100, 
         pct_neg_manslaughter = sum_neg_manslaughter/sum_total_crime*100,
         pct_robbery = sum_robbery/sum_total_crime*100, 
         pct_agg_assault = sum_agg_assault/sum_total_crime*100,
         pct_rape = sum_rape/sum_total_crime*100, 
         pct_fondling = sum_fondling/sum_total_crime*100, 
         pct_statutory = sum_statutory/sum_total_crime*100, 
         pct_incest = sum_incest/sum_total_crime*100,
         pct_burglary = sum_burglary/sum_total_crime*100, 
         pct_motor = sum_motor/sum_total_crime*100, 
         pct_arson = sum_arson/sum_total_crime*100
         )


```

##Break down of violent crime rates,,,,, come back to this??
```{r}
violent_crime_uni <- df %>% group_by(survey_year, institution_me) %>% summarise(violent_crime = sum(violent_crime), rape = sum(rape), murder = sum(murder_non_negligent_manslaughter), robbery = sum(robbery), assault = sum(aggravated_assault))

violent_crime_uni <- violent_crime_uni %>% inner_join(enrollment, by=c("survey_year"="year","institution_me"="institution_name"))

violent_crime_uni <- violent_crime_uni %>% mutate(violent_crime_rate = violent_crime/enrollment*1000) %>% mutate(murder_rate = murder/enrollment*1000) %>% mutate(rape_rate = rape/enrollment*1000) %>% mutate(robbery_rate = robbery/enrollment*1000) %>% mutate(aggravated_assault_rate = assault/enrollment*1000)

violent_crime_uni <- violent_crime_uni %>% select(survey_year, institution_me, violent_crime_rate, murder_rate, rape_rate, robbery_rate, aggravated_assault_rate)

violent_crime_uni_rape <- violent_crime_uni %>% select(survey_year, institution_me, rape_rate)

violent_crime_uni_rape <- violent_crime_uni_rape %>% pivot_wider(names_from = survey_year, values_from = rape_rate)

violent_crime_uni_assault <- violent_crime_uni %>% pivot_wider(names_from = survey_year, values_from = aggravated_assault_rate)

violent_crime_uni_murder <- violent_crime_uni %>% pivot_wider(names_from = survey_year, values_from = murder_rate)

violent_crime_uni_robbery <- violent_crime_uni %>% pivot_wider(names_from = survey_year, values_from = robbery_rate)

```